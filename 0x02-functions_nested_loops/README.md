functions and nested loop director
